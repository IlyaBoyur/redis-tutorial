# Шпоргалка Redis


## Подключение
```bash
# Поднять контейнер с базой Redis в текущей папке
$ docker compose up -d --remove-orphans
$ docker compose exec -it redis sh
/data # redis-cli
127.0.0.1:6379> PING
PONG
```


## Базовые команды
`SET <key> <value>` - добавить значение по ключу  
`GET <key>` - получить значение по ключу  
`INCR <key>` - увеличить на 1 значение по ключу  
`INCRBY <key> <increment>` - увеличить на N значение по ключу    
`DECR <key>` - уменьшить на 1 значение по ключу  
`DECRBY <key> <increment>` - уменьшить на N значение по ключу  
`MSET` - добавить значения по нескольким ключам  
`MGET` - получить значения по нескольким ключам  


### Транзакция
`MULTI` - старт транзакции  
Ввод команд: `SET, GET, INCR, DECR...`  
`EXEC` - выполнить введенные команды по очереди  
(`DISCARD` - отменить транзакцию)  


## Составные типы данных


### Хеш
Хеши играют в Redis роль объектов-контейнеров, способных хра-
нить произвольное число пар ключ-значение.

`HMSET <key> <field> <value> [<field> <value> ...]`  
`HVALS <key>`  
`HKEYS <key>`  
`HGET <key> <field>`  
`HDEL <key> <field> [<field> ...]`  
`HINCRBY <key> <field> <increment>`  
`HLEN <key>`  


### Список
`RPUSH <key> <element>` - вставить элемент справа  
`LLEN <key>` - длина списка  
`LRANGE <key> <start> <stop>` - срез списка. "0" - первый элемент, "-1" - последний элемент  
`LREM <key> <count> <element>` - удалить из списка с заданным ключом указанные значения. Необходимо передать число, сообщающее, сколько элементов с указанным значением удалять. Если этот параметр равен 0, то удаляются все подходящие значения  
`LPOP key [count]` - удалить и вернуть значение (как в очереди, если добавляли через `RPUSH`)  
`RPOP key [count]` - удалить и вернуть значение (как в стеке, если добавляли через `RPUSH`)  
`RPOPLPUSH <source> <destination>` - атомарно удалить из одного списка и добавить в другой


### Блокирующие списки
Redis предлагает несколько блокирующих команд:
`BRPOP <key> [<key> ...] <timeout>` - блокировать консоль и ожидать новое сообщение.  
(Также доступны: `BLPOP`, `BRPOPLPUSH`)

В другой консоли (клиенте):  
`LPUSH <key>` - добавить в список новый элемент  


### Множество
Множеством называется неупорядоченная коллекция без дубликатов.  
Они отлично подходят для выполнения таких операций над
значениями двух и более ключей, как объединение и пересечение.  

`SADD <key> <member> [<member> ...]` - добавить элементы в множество  
`SMEMBERS <key>` - вывести элементы множества  
`SINTER <key> [<key> ...]` - вывести пересечение множеств  
`SDIFF <key> [<key> ...]` - вывести разность множеств  
`SUNION <key> [<key> ...]` - вывести объединение множеств  
`SUNIONSTORE <destionation> <key> [<key> ...]` - сохранить объединение множеств  
(аналогично сохранить результатов пересечения (`SINTERSTORE`) и разности (`SDIFFSTORE`))  
`SMOVE <source> <destionation> <member>` - переместить элемент из одного множества в другое  
`SCARD` - вывести число элементов в множестве  

`SPOP key` - извлечь случайный элемент  
`SREM key value [value ...]` - удалить элемент  


## Отсортированные множества
`ZADD <key> <score> <member>  [<score> <member> ...] ` - добавить элементы в отсортированное множество. Позиция в множестве определяется номером (score)  
`ZINCRBY <key> <increment> <member>` - увеличить/уменьшить позицию на указанную величину  


## Диапазоны
`ZRANGE` возвращает диапазон, заданный своими границами, – как и команда списка `LRANGE`.  
В случае отсортированного множества диапазон еще и упорядочивается по
величине оценки в порядке возрастания.  

### По индексу
`ZRANGE <key> <start> <stop> [WITHSCORES]` - вывести значения сортированного множества в диапазоне с `start` по `stop` (и опционально ключи)  
`ZREVRANGE <key> <start> <stop> [WITHSCORES]`  


### По значению
`ZRANGEBYSCORE visits <key> <min> <max> [WITHSCORES]` - вывести значения (и опционально ключи), где ключи лежат в диапазоне `[min .. max]`  
`ZRANGEBYSCORE visits <key> (<min> <max> [WITHSCORES]` - --//-- в диапазоне `(min .. max]`  
`ZRANGEBYSCORE visits -inf inf` - --//-- в диапазоне от минус до плюс бесконечности  
`ZREVRANGEBYSCORE <key> <max> <min>`  


### Удаление
`ZREMRANGEBYRANK <key> <start> <stop>` - удалить с `start` по `stop`  
`ZREMRANGEBYSCORE <key> <min> <max>` - удалить значения с ключами в диапазоне  `[min .. max]`  


## Объединения
`ZUNIONSTORE <destination> <numkeys> <key> [<key> ...] [WEIGHTS <weight> [<weight> ...]] [AGGREGATE SUM|MIN|MAX]` создать новый ключ, который будет
содержать объединение одного или более ключей  
`ZINTERSTORE <destination> <numkeys> <key> [<key> ...] [WEIGHTS <weight> [<weight> ...]] [AGGREGATE SUM|MIN|MAX]` --//-- пересечение одного или более ключей  


## Срок хранения
`SET <key> <value> EX <seconds>` - установить ключ со сроком хранения  
`SETEX <key> <seconds> <value>` - --//--  
`EXPIRE <key> <seconds>` - установить срок жизни существующего ключа  
`EXISTS <key>` - проверить наличие ключа. Возвращает 0 - нет, 1 - существует  
`TTL <key>` - проверить время жизни ключа (time to live). Для бесконечных возвращает -1, для несуществующих: -2  
`PERSIST <key>` - отменить срок жизни, сделать ключ бессрочным  
`EXPIREAT <key> <unix-time-seconds>` - установить абсолютное время удаления ключа  


## Пространства имен
В терминологии Redis пространство имен называется **базой данных**, и каждому такому пространству сопоставляется числовой ключ.  
Redis позволяет перебрасывать ключи с помощью команды MOVE. Это бывает полезно, когда требуется исполнять на одном сервере Redis разные приложения, разрешая им тем не менее обмениваться данными.  

`SELECT <index>` - переключиться на новое пространство имен (базу данных)  
`MOVE <key> <db>` - переместить ключ из текущего пространства имен в другое  


## Удаление ключей
`DEL <key>` - удалить ключ  
`FLUSHDB [ASYNC | SYNC]` - удалить все ключи из текущей базы данных  
`FLUSHALL [ASYNC | SYNC]` - удалить все ключи из всех баз данных  

